trigger:
- main

pool:
  vmImage: windows-latest

steps:

- task: NuGetToolInstaller@1

- task: UseDotNet@2
  displayName: 'Use .NET Core sdk 5.0'
  inputs:
    packageType: sdk
    version: 5.0.203
    installationPath: $(Agent.ToolsDirectory)\dotnet

- task: CmdLine@2
  displayName: 'Install h5 compiler'
  inputs:
    script: 'dotnet tool install --global h5-compiler'

- script: |
    pushd H5.Dist
    dotnet restore
    dotnet build -c RELEASE
    popd
    pushd dist
    xcopy ..\H5.Dist\bin\Release\netstandard2.0\h5\h5.meta.min.js 
    xcopy ..\H5.Dist\bin\Release\netstandard2.0\h5\h5.min.js
    xcopy ..\H5.Dist\bin\Release\netstandard2.0\h5\h5.js
    xcopy ..\H5.Dist\bin\Release\netstandard2.0\h5\h5.meta.js
    popd
    npm set //registry.npmjs.org/:_authToken $(NPM_TOKEN)
    npm publish --access public
  displayName: 'publish to npm'
